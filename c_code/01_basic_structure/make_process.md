# 编译

## 编译过程
![img.png](.make_process/assembly_process.png)
![img.png](.make_process/make_process.png)
1. 第一个阶段是预处理阶段，在正式的编译阶段之前进行。预处理阶段将根据已放置在文件中的预处理指令来修改源文件的内容。

    1. 把你所有引用的头文件打开来插入到我们本身的程序中。
    2. 预处理阶段会把我们程序中的所有宏进行替换掉，我们经常在程序开头定义一个宏定义，那宏定义的替换就是在预处理阶段完成的。
    3. 我们在编写程序的时候常常会写入一些注释，对程序并没有作用，所以在预处理阶段程序会把我们写入的编译删除掉，机器是看不到我们写的注释的。
    4. 我们的条件编译我们常常会写#ifdef这时候我们不符合条件的那一部分我们机器也是不会看到的，他不会进入到编译阶段。

2. 第二个阶段主要完成的任务就是由编译器来检查一下你的程序是不是有问题是不是有一些语法错误，在vs下编写程序的时候也会编译一下看看我们的程序有没有error或者warning再去执行.
   当你的程序没有问题的时候编译还会把c程序编程汇编语言。
   
3. 第三阶段是汇编阶段，这一阶段就是把我们第二阶段生成的汇编代码变成我们的可执行文件，也就是把我们的汇编语言变成机器语言.

4. 第四个阶段是链接，例如，某个源文件中的函数可能引用了另一个源文件中定义的某个符号（如变量或者函数调用等）；在程序中可能调用了某个库文件中的函数，等等。所有的这些问题，都需要经链接程序的处理方能得以解决。


### 举例

mytest.c
```c
#include "mytest.h"
 
int main(int argc,char **argv) 
{ 
    test = 25; 
    printf("test.................%d/n",test); 
}
 
```

// mytest.h文件
```c
// 头文件内容如下： 
int test;
```

1. 预处理阶段：编译器以C文件作为一 个单元，首先读这个C文件，发现第一句是包含一个头文件，就会在所有搜索路径中寻找这个文件，
   找到之后，就会将相应头文件中再去处理宏，变量， 函数声明，嵌套的头文件包含等，检测依赖关系，进行宏替换，看是否有重复定义与声明的情况发生，
   最后将h文件中所有的内容全部扫描进这个当前的C文件中，形成一个中间“C文件”
   
2. 编译阶段，在上一步中相当于将那个头文件中的test变量扫描进了一个中间C文件，那么test变量就变成了这个文件中的一个全局变量，
   此时就将所有这个中间C文件的所有变量，函数分配空间，将各个函数编译成二进制码，按照特定目标文件格式生成目标文件，
   在这种格式的目标文件中进行各个全局变量，函数的符号描述，将这些二进制码按照一定的标准组织成一个目标文件

3. 连接阶段，将上一步成生的各个目标文件，根据一些参数，连接生成最终的可执行文件，主要的工作就是重定位各个目标文件的函数，变量等，
   相当于将个目标文件中的二进制码按一定的规范合到一个文件中。
